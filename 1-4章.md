#  TCP/IP协议

### 网络层作用

**网络层用来处理在网络上流动的数据包。数据包是网络传输的最小数据单位。该层规定了通过怎样的路径（所谓的传输路线）到达对方计算机，并把数据包传送给对方。**

**与对方计算机之间通过多台计算机或网络设备进行传输时，网络层所起的作用就是在众多的选项内选择一条传输路线**

### 网络各层之间的关系

![](.\http\捕获.PNG)

### IP地址和Mac地址的关系

**IP 地址指明了节点被分配到的地址，MAC 地址是指网卡所属的固定 地址。IP 地址可以和 MAC 地址进行配对。IP 地址可变换，但 MAC 地址基本上不会更改。**



### ARP协议

**IP 间的通信依赖 MAC 地址。在网络上，通信的双方在同一局域网 （LAN）内的情况是很少的，通常是经过多台计算机和网络设备中转 才能连接到对方。而在进行中转时，会利用下一站中转设备的 MAC 地址来搜索下一个中转目标。这时，会采用 ARP 协议（Address Resolution Protocol）。ARP 是一种用以解析地址的协议，根据通信方 的 IP 地址就可以反查出对应的 MAC 地址**



### 数据发送过程

![](.\http\捕获1.PNG)

### TCP协议

**所谓的字节流服务（Byte Stream Service）是指，为了方便传输，将大 块数据分割成以报文段（segment）为单位的数据包进行管理。而可 靠的传输服务是指，能够把数据准确可靠地传给对方。一言以蔽之， TCP 协议为了更容易传送大数据才把数据分割，而且 TCP 协议能够 确认数据最终是否送达到对方**

#### 确保数据能到达目标

**为了准确无误地将数据送达目标处，TCP 协议采用了三次握手 （three-way handshaking）策略。用 TCP 协议把数据包送出去后，TCP 不会对传送后的情况置之不理，它一定会向对方确认是否成功送达。**

**握手过程中使用了 TCP 的标志（flag） —— SYN（synchronize） 和 ACK（acknowledgement）**

![](.\http\捕获3.PNG)

### DNS协议

**他提供了域名到IP地址的解析服务**

![](.\http\捕获4.PNG)

### 联系

![](.\http\捕获5.PNG)

## HTTP协议

### 　HTTP 协议用于客户端和服务器端之间 的通信

### 通过请求和响应的交换达成通信

请求报文是由请求方法、请求 URI、协议版本、可选的请求首部字段 和内容实体构成的

响应报文基本上由协议版本、状态码（表示请求成功或失败的数字代 码）、用以解释状态码的原因短语、可选的响应首部字段以及实体主 体构成。

![](.\http\捕获06.PNG)

![](.\http\捕获07.PNG)

![](.\http\捕获08.PNG)

### HTTP 是不保存状态的协议

HTTP 协议自 身不对请求和响应之间的通信状态进行保存。也就是说在 HTTP 这个 级别，协议对于发送过的请求或响应都不做持久化处理。

使用 HTTP 协议，每当有新的请求发送时，就会有对应的新响应产 生。协议本身并不保留之前一切的请求或响应报文的信息。这是为了 更快地处理大量事务，确保协议的可伸缩性，而特意把 HTTP 协议设 计成如此简单的。

### 请求 URI 定位资源

### HTTP 方法

#### GET 获取资源

#### POST 传输实体主体

#### PUT 传输文件

#### HEAD：获得报文首部 

#### DELETE：删除文件 

#### OPTIONS：询问支持的方法 

#### TRACE：追踪路径 

#### CONNECT：要求用隧道协议连接代理 

CONNECT 方法要求在与代理服务器通信时建立隧道，实现用隧道协 议进行 TCP 通信。主要使用 SSL（Secure Sockets Layer，安全套接 层）和 TLS（Transport Layer Security，传输层安全）协议把通信内容 加 密后经网络隧道传输。 

### 持久连接节省通信量

#### 持久连接

持久连接的特点是，只要任意一端 没有明确提出断开连接，则保持 TCP 连接状态

![](.\http\捕获09.PNG)

持久连接的好处在于减少了 TCP 连接的重复建立和断开所造成的额 外开销，减轻了服务器端的负载。另外，减少开销的那部分时间，使 HTTP 请求和响应能够更早地结束，这样 Web 页面的显示速度也就相 应提高了。

#### 管线化

持久连接使得多数请求以管线化（pipelining）方式发送成为可能。从 前发送请求后需等待并收到响应，才能发送下一个请求。管线化技术 出现后，不用等待响应亦可直接发送下一个请求。这样就能够做到同时并行发送多个请求，而不需要一个接一个地等待 响应了

![](.\http\捕获10.PNG)

#### 使用 Cookie 的状态管理

Cookie 技术通过在请求和响应报文中写入 Cookie 信 息来控制客户端的状态

Cookie 会根据从服务器端发送的响应报文内的一个叫做 Set-Cookie 的 首部字段信息，通知客户端保存 Cookie

当下次客户端再往该服务器 发送请求时，客户端会自动在请求报文中加入 Cookie 值后发送出去。

服务器端发现客户端发送过来的 Cookie 后，会去检查究竟是从哪一 个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前 的状态信息。

![](.\http\捕获11.PNG)

![](.\http\捕获12.PNG)

### HTTP报文信息

#### http报文

用于 HTTP 协议交互的信息被称为 HTTP 报文。请求端（客户端）的 HTTP 报文叫做请求报文，响应端（服务器端）的叫做响应报文。 HTTP 报文本身是由多行（用 CR+LF 作换行符）数据构成的字符串文本

![](.\http\捕获13.PNG)

#### 报文主体和实体主体

##### 主体

通常，报文主体等于实体主体。只有当传输中进行编码操作时，实体 主体的内容发生变化，才导致它和报文主体产生差异

##### 压缩传输

内容编码指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。

###### 内容压缩格式

![](.\http\捕获14.PNG)

#####  分块传输编码

![](.\http\捕获15.PNG)

分块传输编码会将实体主体分成多个部分（块）。每一块都会用十六 进制来标记块的大小，而实体主体的最后一块会使用“0(CR+LF)”来标 记。

#### 多部分对象集合

![](.\http\捕获16.PNG)

#### 获取部分内容的范围请求

以前，用户不能使用现在这种高速的带宽访问互联网，当时，下载一 个尺寸稍大的图片或文件就已经很吃力了。如果下载过程中遇到网络 中断的情况，那就必须重头开始。为了解决上述问题，需要一种可恢 复的机制。所谓恢复是指能从之前下载中断处恢复下载。

要实现该功能需要指定下载的实体范围。像这样，指定范围发送的请 求叫做范围请求（Range Request）。 

#### 内容协商返回最合适的内容

内容协商机制是指客户端和服务器端就响应的资源内容进行交涉，然 后提供给客户端最为适合的资源。内容协商会以响应资源的语言、字 符集、编码方式等作为判断的基准。

以下首部字段是判断的基准

![](.\http\捕获17.PNG)

#### 内容协商技术

###### 服务器驱动协商（Server-driven Negotiation）
由服务器端进行内容协商。以请求的首部字段为参考，在服务器端自 动处理。但对用户来说，以浏览器发送的信息作为判定的依据，并不 一定能筛选出最优内容。

###### 客户端驱动协商（Agent-driven Negotiation）

由客户端进行内容协商的方式。用户从浏览器显示的可选项列表中手 动选择。还可以利用 JavaScript 脚本在 Web 页面上自动进行上述选 择。比如按 OS 的类型或浏览器类型，自行切换成 PC 版页面或手机 版页面。

###### 透明协商（Transparent Negotiation）

是服务器驱动和客户端驱动的结合体，是由服务器端和客户端各自进 行内容协商的一种方法。

### HTTP状态码

#### 状态码的作用

状态码的职责是当客户端向服务器端发送请求时，描述返回的请求结 果。借助状态码，用户可以知道服务器端是正常处理了请求，还是出 现了错误。

![](.\http\捕获18.PNG)

#### 2XX

| 200  | ok              | 正常处理                                                     |
| ---- | --------------- | ------------------------------------------------------------ |
| 204  | no content      | 该状态码代表服务器接收的请求已成功处理，但在返回的响应报文中 不含实体的主体部分 |
| 206  | partial content | 该状态码表示客户端进行了范围请求，而服务器成功执行了这部分的 GET 请求。响应报文中包含由 Content-Range 指定范围的实体内容。 |

#### 3XX

| 301  | moved permanently  | 永久性重定向,按location首部字段提示的url重新保存             |
| ---- | ------------------ | ------------------------------------------------------------ |
| 302  |                    | 临时性重定向.希望用户本次使用新的url                         |
| 303  | see  other         | 当使用 POST 方法访问 CGI 程序，其执行后的处理结果是希望 客户端能以 GET 方法重定向到另一个 URI 上去时，返回 303 状态 码 |
| 304  | not modified       | 该状态码表示客户端发送附带条件的请求 2 时，服务器端允许请求访 问资源，但未满足条件的情况。304 状态码返回时，不包含任何响应 的主体部分。304 虽然被划分在 3XX 类别中，但是和重定向没有关 系。 |
| 307  | temporary redirect | 临时重定向。该状态码与 302 Found 有着相同的含义              |

#### 4XX

| 400  | bad request  | 该状态码表示请求报文中存在语法错误                           |
| ---- | ------------ | ------------------------------------------------------------ |
| 401  | Unauthorized | 该状态码表示发送的请求需要有通过 HTTP 认证（BASIC 认证、 DIGEST 认证）的认证信息。另外若之前已进行过 1 次请求，则表示 用 户认证失败。 |
| 403  | Forbidden    | 该状态码表明对请求资源的访问被服务器拒绝了。服务器端没有必要 给出拒绝的详细理由 |
| 404  | Not Found    | 该状态码表明服务器上无法找到请求的资源。除此之外，也可以在服 务器端拒绝请求且不想说明理由时使用。 |

#### 5xx

| 500  | Internal Server Error | 该状态码表明服务器端在执行请求时发生了错误。也有可能是 Web 应用存在的 bug 或某些临时的故障。 |
| ---- | --------------------- | ------------------------------------------------------------ |
| 503  | Service Unavailable   | 该状态码表明服务器暂时处于超负载或正在进行停机维护，现在无法 处理请求。如果事先得知解除以上状况需要的时间，最好写入 Retry After 首部字段再返回给客户端。 |

